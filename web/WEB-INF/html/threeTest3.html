<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>啊啊啊啊啊啊啊啊啊啊啊啊啊</title>

<script src="../js/jquery-3.1.1.min.js"></script>
<!-- r83 -->
<script src="../js/three/build/three.min.js"></script>
<script src="../js/three/examples/js/libs/dat.gui.min.js"></script>
<script src="../js/three/examples/js/libs/stats.min.js"></script>


<script src="../js/three/examples/js/controls/OrbitControls.js"></script>
<script src="../js/three/src/loaders/TextureLoader.js"></script>
<script src="../js/three/examples/js/controls/DragControls.js"></script>


<script src="../js/three/physi.js"></script>


<script>
Physijs.scripts.worker = '../js/three/physijs_worker.js';
Physijs.scripts.ammo = '../three/examples/js/libs/ammo.js';
//var scene = new THREE.Scene();
var scene = new Physijs.Scene();
scene.setGravity(new THREE.Vector3( 0, -150, 0 ));
var selected_block = null;
var blocks = [];
var mouse_position = new THREE.Vector3



var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);

var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
renderer.shadowMap.type=THREE.PCFSoftShadowMap;//影子材质

function init() {
	var controls = new function () {
        this.clone_x = 0;
    };
    
 // 实例化一个加载器
    var loader = new THREE.ObjectLoader();
    // 加载一个资源
    loader.load(
    	'model2.json',
    	function ( geometry ) {
    		OBJ = geometry.children[0];
    		//OBJ.getObjectByName("Box2");
    		
    		console.log(OBJ.getObjectByName("Box2"))
    		geometry.translateY(15);
    		//geometry.children[0].rotation.x += 1
    		//scene.add( geometry );
    	}
    );
    
    
	camera.position.y = 100;
	camera.position.z = 130;
	camera.lookAt(scene.position);
	scene.add(camera)
	//创建坐标轴
    var axes = new THREE.AxisHelper(20);
    scene.add(axes);
	
	var hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6 );
	hemiLight.color.setHSL( 0.6, 1, 0.6 );
	hemiLight.groundColor.setHSL( 0.095, 1, 0.75 );
	hemiLight.position.set( 0, 500, 0 );
	scene.add( hemiLight );
	
	var dirLight = new THREE.DirectionalLight( 0xffffff, 1 );
	dirLight.color.setHSL( 0.1, 1, 0.95 );
	dirLight.position.set( -1, 1.75, 1 );
	dirLight.position.multiplyScalar( 50 );
	dirLight.castShadow = true;//投影,能够照射出阴影的光源
	dirLight.shadow.mapSize.height = 2048;//提升光贴图质量
	dirLight.shadow.mapSize.width = 2048;
	scene.add( dirLight );

	dirLight.castShadow = true;

	dirLight.shadow.mapSize.width = 2048;
	dirLight.shadow.mapSize.height = 2048;
	
	var textureLoader = new THREE.TextureLoader();

	var texture = textureLoader.load( "jpg.jpg" );
	texture.repeat.set( 20, 10 );
	texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
	texture.format = THREE.RGBFormat;
	//平面
	var matParams = {
			specular: 0xFFFFFF,
			shininess: 10000,
			map: THREE.ImageUtils.loadTexture("jpg.jpg")
		};
	ground_material = Physijs.createMaterial(
			new THREE.MeshPhongMaterial(matParams),
			0.9, // high friction
			0.1 // low restitution
		);
	
	var ground = new Physijs.BoxMesh(new THREE.BoxGeometry(160, 1, 160), ground_material, 0);
	scene.add(ground)
	
	//方块物体
    var cubeGeometry = new THREE.BoxGeometry(14, 14, 14);
	cubeMaterial = Physijs.createMaterial(
			new THREE.MeshPhongMaterial(matParams),
			0.9, // high friction
			0.1 // low restitution
		);
    //var cubeMaterial = new THREE.MeshPhongMaterial({color: 0xff0000,shininess: 10000});
    var cube = new Physijs.BoxMesh(cubeGeometry, cubeMaterial);
    cube.castShadow = true;//允许放出阴影
    cube.receiveShadow = true;
    cube.position.x = 5;
    cube.position.y = 100;
    cube.position.z = 5;
    scene.add(cube);
	
    //克隆
    var cloned = cube.clone();
    cubeMaterial2 = Physijs.createMaterial(
			new THREE.MeshPhongMaterial(matParams),
			0.9, // high friction
			0.5 // low restitution
		);
    //var m2 = new THREE.MeshPhongMaterial({color:0x7777ff,shininess: 10000});
    var cube2 = new Physijs.BoxMesh(cloned.geometry, cubeMaterial2);
    cube2.translateX(15);
    cube2.translateY(15);
    cube2.translateZ(5)
    cube2.name="clone";
    scene.add(cube2);
    
    
  	//球物体
    var cubeGeometry = new THREE.SphereGeometry(14, 14, 14);
	cubeMaterial = Physijs.createMaterial(
			new THREE.MeshPhongMaterial(matParams),
			0.9, // high friction
			0.1 // low restitution
		);
    //var cubeMaterial = new THREE.MeshPhongMaterial({color: 0xff0000,shininess: 10000});
    var Sphere = new Physijs.SphereMesh(cubeGeometry, cubeMaterial);
    Sphere.castShadow = true;//允许放出阴影
    Sphere.receiveShadow = true;
    Sphere.position.x = 5;
    Sphere.position.y = 100;
    Sphere.position.z = 5;
    scene.add(Sphere);
    
    //scene.setGravity(new THREE.Vector3(10,-50,10));
	
    var objects = [];
    objects.push(cube);
    objects.push(cube2);
    objects.push(Sphere);
  	//拖动控件
    var dragControls = new THREE.DragControls( objects, camera, renderer.domElement );
	dragControls.addEventListener( 'dragstart', function ( event ) { console.log(111) } );
	dragControls.addEventListener( 'dragend', function ( event ) { console.log(222) } );
    
	document.getElementById("WebGL-output").appendChild(renderer.domElement);
	scene.simulate();
    render();
    function render() {
    	ground.rotation.x = controls.clone_x;
    	cube2.rotation.x = controls.clone_x;
        requestAnimationFrame(render);
        renderer.render(scene, camera);
        ground.__dirtyRotation = true;
        cube2.__dirtyRotation=true;
        cube.__dirtyRotation=true;
        cube.__dirtyPosition=true;
        cube2.__dirtyPosition=true;
        ground.__dirtyPosition=true;
        Sphere.__dirtyRotation=true;
        Sphere.__dirtyPosition=true;
        scene.simulate(undefined, 1);
    }

    
    
	//GUI调试工具
    var gui = new dat.GUI();
    gui.add(controls, 'clone_x', -5, 5);
    
    //var orbitControls = new THREE.OrbitControls(camera);  
    //orbitControls.autoRotate = true;
}

window.onload = init;



</script>
</head>
<body>
<video id="video" autoplay loop webkit-playsinline style="display:none;">
	
</video>
<div id="Stats-output">
</div>
	<div id="WebGL-output">
	</div>
</body>
</html>